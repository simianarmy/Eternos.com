<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>blech</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <script src="../lib/prototype/dist/prototype.js" type="text/javascript"></script>
  <script src="deferuntil.js" type="text/javascript"></script>
</head>
<body>
  <p id="countdown">--waiting--</p>
  
  <script type="text/javascript" charset="utf-8">
    // countdown to 0
    (function(){
      var count = 4,
        timeout = setTimeout(function(){
          $('countdown').update(--count);
          if(count>0) timeout = setTimeout(arguments.callee, 1000);
        }, 1000);
    })();
    
    // poll condition until true, then execute function
    (function(){
      alert('go!');
    }).curry('hello world!').deferUntil(function(){
      return $('countdown').innerHTML == "0";
    });
  </script>
</body>
</html>